# 0-OS v2 Provisioning schemas

Generic reservation type
```go
const (
	// ContainerReservation type
	ContainerReservation ReservationType = "container"
	// VolumeReservation type
	VolumeReservation ReservationType = "volume"
	// NetworkReservation type
	NetworkReservation ReservationType = "network"
	// ZDBReservation type
	ZDBReservation ReservationType = "zdb"
)


// Reservation struct
type Reservation struct {
	// ID of the reservation
	ID string `json:"id"`
	// NodeID of the node where to deploy this reservation
	NodeID string `json:"node_id"`
	// Identification of the user requesting the reservation
	User string `json:"user_id"`
	// Type of the reservation (container, zdb, vm, etc...)
	Type ReservationType `json:"type"`
	// Data is the reservation type arguments.
	Data json.RawMessage `json:"data,omitempty"`
	// Date of creation
	Created time.Time `json:"created"`
	// Duration of the reservation
	Duration time.Duration `json:"duration"`
	// Signature is the signature to the reservation
	// it contains all the field of this struct except the signature itself and the Result field
	Signature []byte `json:"signature,omitempty"`

	// This flag is set to true when a reservation needs to be deleted
	// before its expiration time
	ToDelete bool `json:"to_delete"`

	// Tag object is mainly used for debugging.
	Tag Tag `json:"-"`
}

// Result is the struct filled by the node
// after a reservation object has been processed
type Result struct {
	Type ReservationType `json:"type"`
	//Reservation ID
	ID string `json:"id"`
	// Time when the result is sent
	Created time.Time `json:"created"`
	// State of the deployment (ok,error)
	State string `json:"state"`
	// if State is "error", then this field contains the error
	// otherwise it's nil
	Error string `json:"error"`
	// Data is the information generated by the provisioning of the workload
	// its type depend on the reservation type
	Data json.RawMessage `json:"data"`
	// Signature is the signature to the result
	// it contains all the field of this struct except the signature itself
	Signature []byte `json:"signature"`
}

```

Container provision schema

```go
// Network struct
type Network struct {
	NetworkID pkg.NetID `json:"network_id"`
	// IP to give to the container
	IPs []net.IP `json:"ips"`
	// If true, the container will receive a public IPv6 address
	PublicIP6 bool     `json:"public_ip6"`
}

// Mount defines a container volume mounted inside the container
type Mount struct {
	VolumeID   string `json:"volume_id"`
	Mountpoint string `json:"mountpoint"`
}
	
// ContainerCapacity is the amount of resource to allocate to the container
type ContainerCapacity struct {
	// Number of CPU
	CPU uint `json:"cpu"`
	// Memory in MiB
	Memory uint64 `json:"memory"`
}

//Container creation info
type Container struct {
	// URL of the flist
	FList string `json:"flist"`
	// URL of the storage backend for the flist
	FlistStorage string `json:"flist_storage"`
	// Env env variables to container in format
	Env map[string]string `json:"env"`
	// Entrypoint the process to start inside the container
	Entrypoint string `json:"entrypoint"`
	// Interactivity enable Core X as PID 1 on the container
	Interactive bool `json:"interactive"`
	// Mounts extra mounts in the container
	Mounts []Mount `json:"mounts"`
	// Network network info for container
	Network Network `json:"network"`
	// ContainerCapacity is the amount of resource to allocate to the container
	Capacity ContainerCapacity `json:"capacity"`
	// Logs contains a list of endpoint where to send containerlogs
	Logs []logger.Logs `json:"logs,omitempty"`
}

// ContainerResult is the information return to the BCDB
// after deploying a container
type ContainerResult struct {
	ID   string `json:"id"`
	IPv6 string `json:"ipv6"`
	IPv4 string `json:"ipv4"`
}

//
// Package logger
//
// Logs defines a custom (redis for now) backend 
type Logs struct {
	Type string    `json:"type"`
	Data LogsRedis `json:"data"`
}

// LogsRedis defines how to connect a redis logs backend
type LogsRedis struct {
	Endpoint string `json:"endpoint"`
	Channel  string `json:"channel"`
}
```

Volume provision schema

```go

// DiskType defines disk type
type DiskType string

const (
	// HDDDiskType for hdd disks
	HDDDiskType DiskType = "HDD"
	// SSDDiskType for ssd disks
	SSDDiskType DiskType = "SSD"
)

// Volume defines a mount point
type Volume struct {
	// Size of the volume in GiB
	Size uint64 `json:"size"`
	// Type of disk underneath the volume
	Type DiskType `json:"type"`
}

// VolumeResult is the information return to the BCDB
// after deploying a volume
type VolumeResult struct {
	ID string `json:"volume_id"`
}
```

Network provision schema

```go
// NetID is a type defining the ID of a network
type NetID string

// Network represent the description if a user private network
type Network struct {
	Name string `json:"name"`
	// IP range of the network, must be an IPv4 /16
	IPRange types.IPNet `json:"ip_range"`
	NetResources []NetResource `json:"net_resources"`
}

// NetResource is the description of a part of a network local to a specific node
type NetResource struct {
	NodeID string `json:"node_id"`
	// IPV4 subnet from network IPRange
	Subnet types.IPNet `json:"subnet"`

	WGPrivateKey string `json:"wg_private_key"`
	WGPublicKey  string `json:"wg_public_key"`
	WGListenPort uint16 `json:"wg_listen_port"`

	Peers []Peer `json:"peers"`
}

// Peer is the description of a peer of a NetResource
type Peer struct {
	// IPV4 subnet of the network resource of the peer
	Subnet types.IPNet `json:"subnet"`

	WGPublicKey string        `json:"wg_public_key"`
	AllowedIPs  []types.IPNet `json:"allowed_ips"`
	Endpoint    string        `json:"endpoint"`
}
```

0-db namespace provision schema

```go
// ZDB namespace creation info
type ZDB struct {
	Size     uint64         `json:"size"`
	Mode     pkg.ZDBMode    `json:"mode"`
	Password string         `json:"password"`
	DiskType pkg.DeviceType `json:"disk_type"`
	Public   bool           `json:"public"`
}

// ZDBResult is the information return to the BCDB
// after deploying a 0-db namespace
type ZDBResult struct {
	Namespace string
	IP        string
	Port      uint
}
```

Kubernetes vm provision schema

```go
// Kubernetes reservation data
type Kubernetes struct {
    // Size of the vm, this defines the amount of vCpu, memory, and the disk size
    // Docs: docs/kubernetes/sizes.md
    Size uint8 `json:"size"`

    // NetworkID of the network namepsace in which to run the VM. The network
    // must be provisioned previously.
    NetworkID pkg.NetID `json:"network_id"`
    // IP of the VM. The IP must be part of the subnet available in the network
    // resource defined by the networkID on this node
    IP net.IP `json:"ip"`

    // ClusterSecret is the hex encoded encrypted cluster secret.
    ClusterSecret string `json:"cluster_secret"`
    // MasterIPs define the URL's for the kubernetes master nodes. If this
    // list is empty, this node is considered to be a master node.
    MasterIPs []net.IP `json:"master_ips"`
    // SSHKeys is a list of ssh keys to add to the VM. Keys can be either
    // a full ssh key, or in the form of `github:${username}`. In case of
    // the later, the VM will retrieve the github keys for this username
    // when it boots.
    SSHKeys []string `json:"ssh_keys"`

    PlainClusterSecret string `json:"-"`
}

// KubernetesResult result returned by k3s reservation
type KubernetesResult struct {
    ID string `json:"id"`
    IP string `json:"ip"`
}
```
